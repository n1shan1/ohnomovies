<div class="p-6 max-w-screen-2xl mx-auto">
  <p-button
    label="Back"
    icon="pi pi-arrow-left"
    styleClass="mb-6"
    [text]="true"
    (onClick)="goBack()"
  >
  </p-button>

  <div class="grid lg:grid-cols-3 gap-6">
    <!-- Seat Map Section -->
    <div class="lg:col-span-2">
      <p-card>
        <ng-template pTemplate="header">
          <div class="p-6 bg-gray-50">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Select Your Seats</h2>

            <!-- Legend -->
            <div class="flex flex-wrap gap-4 text-sm">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 seat-available rounded"></div>
                <span>Available</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 seat-vip rounded"></div>
                <span>VIP</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 seat-selected rounded"></div>
                <span>Selected</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 seat-booked rounded"></div>
                <span>Booked</span>
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Loading State -->
        @if (isLoading) {
        <div class="flex justify-center items-center py-20">
          <p-progressSpinner></p-progressSpinner>
        </div>
        }

        <!-- Screen Indicator -->
        @if (!isLoading) {
        <div class="mb-8">
          <div
            class="h-1 bg-linear-to-b from-blue-500 to-transparent rounded-t-full shadow-lg shadow-blue-500/50"
          ></div>
          <p class="text-center text-gray-600 text-sm mt-2">SCREEN</p>
        </div>
        }

        <!-- Seat Grid -->
        @if (!isLoading) {
        <div>
          @for (row of getRows(); track row) {
          <div class="mb-3">
            <div class="flex items-center gap-2">
              <span class="text-gray-700 font-semibold w-8 text-center min-w-8">{{ row }}</span>
              <div class="flex gap-2 flex-wrap">
                @for (seat of seatsByRow.get(row); track seat.id) {
                <button
                  [class]="'seat ' + getSeatClass(seat)"
                  [disabled]="seat.status !== 'AVAILABLE'"
                  (click)="toggleSeat(seat)"
                  [title]="seat.seatRow + seat.seatNumber"
                >
                  {{ seat.seatNumber }}
                </button>
                }
              </div>
            </div>
          </div>
          }
        </div>
        }
      </p-card>
    </div>

    <!-- Booking Summary Sidebar -->
    <div class="lg:col-span-1">
      <p-card styleClass="sticky top-24">
        <ng-template pTemplate="header">
          <div class="p-4 bg-blue-600 text-white">
            <h3 class="text-xl font-bold">Booking Summary</h3>
          </div>
        </ng-template>

        <div class="space-y-4">
          <div>
            <h4 class="font-semibold text-gray-700 mb-2">Selected Seats</h4>
            @if (selectedSeats.length === 0) {
            <div class="text-gray-500 text-sm">No seats selected yet</div>
            } @if (selectedSeats.length > 0) {
            <div class="flex flex-wrap gap-2">
              @for (seat of selectedSeats; track seat.id) {
              <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                {{ seat.seatNumber }}
              </span>
              }
            </div>
            }
          </div>

          <p-divider></p-divider>

          <div>
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600">Seats</span>
              <span class="font-semibold">{{ selectedSeats.length }}</span>
            </div>
            <div class="flex justify-between items-center text-lg font-bold">
              <span>Total Amount</span>
              <span class="text-blue-600">â‚¹{{ getTotalAmount().toFixed(2) }}</span>
            </div>
          </div>
        </div>

        <ng-template pTemplate="footer">
          <p-button
            label="Proceed to Book"
            icon="pi pi-check"
            styleClass="w-full"
            [loading]="isSubmitting"
            [disabled]="selectedSeats.length === 0"
            (onClick)="proceedToBooking()"
          >
          </p-button>
        </ng-template>
      </p-card>
    </div>
  </div>
</div>
